# üöÄ Deployment Guide - Highlight ERP

–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é Highlight ERP –≤ production —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#production-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ](#–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [Troubleshooting](#troubleshooting)

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **OS**: Ubuntu 20.04+ / Debian 11+ / CentOS 8+
- **CPU**: 2+ cores
- **RAM**: 4GB –º–∏–Ω–∏–º—É–º, 8GB —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
- **Disk**: 20GB+ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **Docker**: 24.0+
- **Docker Compose**: 2.20+

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker

```bash
# Ubuntu/Debian
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/your-org/highlight-erp.git
cd highlight-erp
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª –∏–∑ –ø—Ä–∏–º–µ—Ä–∞
cp .env.production.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env —Ñ–∞–π–ª
nano .env
```

**–í–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env:**

```env
APP_KEY=  # –ë—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
APP_URL=https://your-domain.com
DB_PASSWORD=your_strong_database_password
REDIS_PASSWORD=your_strong_redis_password
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
make install
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç .env —Ñ–∞–π–ª
- ‚úÖ –°–æ–±–µ—Ä–µ—Ç Docker –æ–±—Ä–∞–∑—ã
- ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç APP_KEY
- ‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç storage link

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
make health

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
docker-compose ps
```

**–î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:**
- üåê Frontend: http://localhost:3000
- üîß Backend API: http://localhost:8000/api
- üìä PostgreSQL: localhost:5432
- üì¶ Redis: localhost:6379

## üè≠ Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –û–±–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã
sudo apt install -y git make curl

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å firewall
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp
sudo ufw enable
```

### 2. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Certbot
sudo apt install -y certbot

# –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot certonly --standalone -d your-domain.com -d www.your-domain.com
```

### 3. Nginx Reverse Proxy (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Nginx –∫–∞–∫ reverse proxy –Ω–∞ —Ö–æ—Å—Ç–µ:

```nginx
# /etc/nginx/sites-available/highlight-erp
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com www.your-domain.com;

    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;

    # SSL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    # –õ–æ–≥–∏
    access_log /var/log/nginx/highlight-erp-access.log;
    error_log /var/log/nginx/highlight-erp-error.log;

    # –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ frontend
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 4. Production deploy

```bash
# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ production
make production-deploy
```

### 5. –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã

```bash
# –°–æ–∑–¥–∞—Ç—å systemd service
sudo nano /etc/systemd/system/highlight-erp.service
```

```ini
[Unit]
Description=Highlight ERP Docker Compose
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
WorkingDirectory=/path/to/highlight-erp
ExecStart=/usr/local/bin/docker-compose up -d
ExecStop=/usr/local/bin/docker-compose down
TimeoutStartSec=0

[Install]
WantedBy=multi-user.target
```

```bash
# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å service
sudo systemctl enable highlight-erp
sudo systemctl start highlight-erp
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|-----------|----------|-------------|
| `APP_ENV` | –û–∫—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | `production` |
| `APP_DEBUG` | –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ | `false` |
| `DB_DATABASE` | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | `highlight_erp` |
| `DB_USERNAME` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î | `postgres` |
| `DB_PASSWORD` | –ü–∞—Ä–æ–ª—å –ë–î | - |
| `REDIS_PASSWORD` | –ü–∞—Ä–æ–ª—å Redis | - |
| `BACKEND_PORT` | –ü–æ—Ä—Ç backend | `8000` |
| `FRONTEND_PORT` | –ü–æ—Ä—Ç frontend | `3000` |

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ Queue Workers

```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ workers
docker-compose up -d --scale queue=3
```

#### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `docker-compose.yml`:

```yaml
services:
  app:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G
```

## üîß –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
make logs                 # –í—Å–µ –ª–æ–≥–∏
make logs-app            # –õ–æ–≥–∏ Laravel
make logs-queue          # –õ–æ–≥–∏ –æ—á–µ—Ä–µ–¥–µ–π
make logs-frontend       # –õ–æ–≥–∏ frontend

# –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
make cache-clear         # –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∫–µ—à–∏
make cache-optimize      # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à–∏

# –ú–∏–≥—Ä–∞—Ü–∏–∏
make migrate             # –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make migrate-fresh       # –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ë–î (–û–°–¢–û–†–û–ñ–ù–û!)

# Shell –¥–æ—Å—Ç—É–ø
make shell-app           # Shell –≤ Laravel –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
make shell-db            # Shell –≤ PostgreSQL
make shell-redis         # Shell –≤ Redis

# Artisan –∫–æ–º–∞–Ω–¥—ã
make artisan cmd="route:list"
make artisan cmd="queue:work"
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main

# 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
make build

# 3. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
make down

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –Ω–æ–≤—ã–º–∏ –æ–±—Ä–∞–∑–∞–º–∏
make up

# 5. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make migrate

# 6. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å
make cache-optimize
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–Ω—É –∫–æ–º–∞–Ω–¥—É:

```bash
make production-deploy
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Checks

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏–º–µ—é—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ health checks:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make health
```

### Prometheus + Grafana (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–æ–±–∞–≤—å—Ç–µ –≤ `docker-compose.yml`:

```yaml
  prometheus:
    image: prom/prometheus:latest
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    ports:
      - "9090:9090"
    networks:
      - highlight-network

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3001:3000"
    volumes:
      - grafana_data:/var/lib/grafana
    networks:
      - highlight-network
```

## üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞—Ç—å backup
make backup-db

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup
make restore-db file=backup_20240101_120000.sql
```

### –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup (cron)

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab
crontab -e
```

```cron
# Backup –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00 AM
0 3 * * * cd /path/to/highlight-erp && make backup-db >> /var/log/backup.log 2>&1

# –£–¥–∞–ª—è—Ç—å backups —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
0 4 * * * find /path/to/highlight-erp/backup_*.sql -mtime +30 -delete
```

### Backup storage files

```bash
# –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏–≤ storage
tar -czf storage_backup_$(date +%Y%m%d).tar.gz \
  -C highlight-erp/storage/app public

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å storage
tar -xzf storage_backup_20240101.tar.gz \
  -C highlight-erp/storage/app
```

## üêõ Troubleshooting

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs app

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose up -d --force-recreate app
```

### –û—à–∏–±–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
make artisan cmd="migrate:rollback"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
make artisan cmd="migrate:status"

# –û—á–∏—Å—Ç–∏—Ç—å –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ë–î (–û–°–¢–û–†–û–ñ–ù–û!)
make migrate-fresh
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞

```bash
# –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ storage
docker-compose exec app chown -R www-data:www-data storage bootstrap/cache
docker-compose exec app chmod -R 775 storage bootstrap/cache
```

### –ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏

```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å memory limit –≤ docker-compose.yml
services:
  app:
    deploy:
      resources:
        limits:
          memory: 2G

# –ò–ª–∏ –¥–ª—è –≤—Å–µ–≥–æ Docker
sudo nano /etc/docker/daemon.json
{
  "default-ulimits": {
    "memlock": {
      "Hard": -1,
      "Name": "memlock",
      "Soft": -1
    }
  }
}

sudo systemctl restart docker
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å LibreOffice –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É LibreOffice
make shell-app
soffice --version

# –¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
soffice --headless --convert-to pdf test.docx --outdir /tmp
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **Email**: support@your-company.com
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://docs.your-company.com
- **Issues**: https://github.com/your-org/highlight-erp/issues

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Proprietary - All rights reserved
